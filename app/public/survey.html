<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Friend Finder: Survey</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.15.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.min.js"></script>
        <style>
            .dropdown {
                position: relative;
            }
            p {
                font-size: 18px;
            }
            select {
                float: left;
                margin-right: 15px;
                margin-top: 2px;
                border-width: 1.5px;
            }
            select:hover {
                border-color: purple;
            }
            option:active {
                background-color: purple;
                color: white;
            }
            img {
                max-width: 200px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="jumbotron">
                <h1><strong>Survey Questions</strong></h1>
                <hr>
                <h3>About You</h3>
                <br>
                <p>Your Name (Required):</p>
                <input type="text" id="your-name" class="form-control">
                <br>
                <p>Your Photo Link (Required):</p>
                <input type="text" id="your-pic" class="form-control">
                <br>
                <hr>
                <br>
                <div>
                    <select class="chosen-select" data-qnum="0">
                        <option>Select . . .</option>
                        <option class="choice" value="1">1. Strongly Disagree</option>
                        <option class="choice" value="2">2. Disagree</option>
                        <option class="choice" value="3">3. On the Fence</option>
                        <option class="choice" value="4">4. Agree</option>
                        <option class="choice" value="5">5. Strongly Agree</option>
                    </select>
                    <p><strong>1. There are a total of 24 numbers known to man.</strong></p>
                </div>
                <br>
                <div>
                    <select class="chosen-select" data-qnum="1">
                        <option>Select . . .</option>
                        <option class="choice" value="1">1. Strongly Disagree</option>
                        <option class="choice" value="2">2. Disagree</option>
                        <option class="choice" value="3">3. On the Fence</option>
                        <option class="choice" value="4">4. Agree</option>
                        <option class="choice" value="5">5. Strongly Agree</option>
                    </select>
                    <p><strong>2. The center of the moon contains an entire wheel of cheese, which is most likely cheddar.</strong></p>
                </div>
                <br>
                <div>
                    <select class="chosen-select" data-qnum="2">
                        <option>Select . . .</option>
                        <option class="choice" value="1">1. Strongly Disagree</option>
                        <option class="choice" value="2">2. Disagree</option>
                        <option class="choice" value="3">3. On the Fence</option>
                        <option class="choice" value="4">4. Agree</option>
                        <option class="choice" value="5">5. Strongly Agree</option>
                    </select>
                    <p><strong>3. Trees are actually roots; the real tree grows underground.</strong></p>
                </div>
                <br>
                <div>
                    <select class="chosen-select" data-qnum="3">
                        <option>Select . . .</option>
                        <option class="choice" value="1">1. Strongly Disagree</option>
                        <option class="choice" value="2">2. Disagree</option>
                        <option class="choice" value="3">3. On the Fence</option>
                        <option class="choice" value="4">4. Agree</option>
                        <option class="choice" value="5">5. Strongly Agree</option>
                    </select>
                    <p><strong>4. The word "dog" is derived from the Latin "<opaque>dog</opaque>", whispered softly.</strong></p>
                </div>
                <br>
                <div>
                    <select class="chosen-select" data-qnum="4">
                        <option>Select . . .</option>
                        <option class="choice" value="1">1. Strongly Disagree</option>
                        <option class="choice" value="2">2. Disagree</option>
                        <option class="choice" value="3">3. On the Fence</option>
                        <option class="choice" value="4">4. Agree</option>
                        <option class="choice" value="5">5. Strongly Agree</option>
                    </select>
                    <p><strong>5. The seven dwarves from the Disney Classic <opaque>Snow White</opaque> were initially written to be seven trolls, but the actress playing Snow White was too terrified of the trolls that she would not show up for filming.</strong></p>
                </div>
                <br>
                <div>
                    <select class="chosen-select" data-qnum="5">
                        <option>Select . . .</option>
                        <option class="choice" value="1">1. Strongly Disagree</option>
                        <option class="choice" value="2">2. Disagree</option>
                        <option class="choice" value="3">3. On the Fence</option>
                        <option class="choice" value="4">4. Agree</option>
                        <option class="choice" value="5">5. Strongly Agree</option>
                    </select>
                    <p><strong>6. I like normal, relatable surveys.</strong></p>
                </div>
                <br>
                <div>
                    <select class="chosen-select" data-qnum="6">
                        <option>Select . . .</option>
                        <option class="choice" value="1">1. Strongly Disagree</option>
                        <option class="choice" value="2">2. Disagree</option>
                        <option class="choice" value="3">3. On the Fence</option>
                        <option class="choice" value="4">4. Agree</option>
                        <option class="choice" value="5">5. Strongly Agree</option>
                    </select>
                    <p><strong>7. I enjoy long walks on the beach.</strong></p>
                </div>
                <br>
                <div>
                    <select class="chosen-select" data-qnum="7">
                        <option>Select . . .</option>
                        <option class="choice" value="1">1. Strongly Disagree</option>
                        <option class="choice" value="2">2. Disagree</option>
                        <option class="choice" value="3">3. On the Fence</option>
                        <option class="choice" value="4">4. Agree</option>
                        <option class="choice" value="5">5. Strongly Agree</option>
                    </select>
                    <p><strong>8. I am comfortable in crowds.</strong></p>
                </div>
                <br>
                <div>
                    <select class="chosen-select" data-qnum="8">
                        <option>Select . . .</option>
                        <option class="choice" value="1">1. Strongly Disagree</option>
                        <option class="choice" value="2">2. Disagree</option>
                        <option class="choice" value="3">3. On the Fence</option>
                        <option class="choice" value="4">4. Agree</option>
                        <option class="choice" value="5">5. Strongly Agree</option>
                    </select>
                    <p><strong>9. I am afraid of heights.</strong></p>
                </div>
                <br>
                <div>
                    <select class="chosen-select" data-qnum="9">
                        <option>Select . . .</option>
                        <option class="choice" value="1">1. Strongly Disagree</option>
                        <option class="choice" value="2">2. Disagree</option>
                        <option class="choice" value="3">3. On the Fence</option>
                        <option class="choice" value="4">4. Agree</option>
                        <option class="choice" value="5">5. Strongly Agree</option>
                    </select>
                    <p><strong>10. I enjoy attending sports events.</strong></p>
                </div>
                <br>
                <button type="button" class="btn btn-primary submit" data-toggle="modal" data-target="#match">Submit</button>                    
            </div>
        </div>
        <div class="modal fade" id="match" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">It's A Match!</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body">
                    Your ideal friend is none but <strong><span id="friend-match"></span></strong>!
                </div>
                <div class="modal-body">
                    <img id="match-pic">
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
            </div>
        </div>        
        <footer class="footer">
            <div class="container">
                <p>
                    <a href="/api/friends">API Friends Link</a>
                </p>
            </div>
        </footer>
        <script type="text/javascript">
            var userResults = [];
            $(".chosen-select").on("click", function(event) {
                event.preventDefault();
                var sel = $(this)
                var qnum = sel.data("qnum");
                var selected = parseInt(sel.val());
                if(selected <= 5) {
                    userResults[qnum] = selected;
                }
            });
            $(".submit").on("click", function(event) {
                event.preventDefault();
                function getFriends() {
                    var totalDiff = 100;
                    var matchN;
                    var matchP;
                    var newFriend = {
                        name: $("#your-name").val().trim(),
                        photo: $("#your-pic").val().trim(),
                        scores: userResults
                    };
                    console.log(newFriend);
                    $.ajax({ url: "/api/friends", method: "GET" }).then(function(data) {
                        for (var i = 0; i < data.length; i++) {
                            var diff = 0;
                            for (var j = 0; j < userResults.length; j++) {
                                diff += Math.abs(data[i].scores[j] - userResults[j]);
                            }
                            if(diff < totalDiff) {
                                totalDiff = diff;
                                matchN = data[i].name;
                                matchP = data[i].photo;
                            }
                        }
                        $("#your-name").val("");
                        $("#your-pic").val("");
                        $("#friend-match").html(matchN);
                        $("#match-pic").attr("src", matchP);
                        console.log(matchN);
                        console.log(matchP);
                        $.post("/api/friends", newFriend).then(function(err) {
                            if(err) throw err;
                        });
                    });
                }
                getFriends();
            });
        </script>
    </body>
</html>
